<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      HAN's BLOG &middot; 
    
  </title>

  
  <link rel="canonical" href="https://hanseopark.github.io/">
  

  <link rel="stylesheet" href="https://hanseopark.github.io/public/css/poole.css">
  <link rel="stylesheet" href="https://hanseopark.github.io/public/css/syntax.css">
  <link rel="stylesheet" href="https://hanseopark.github.io/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hanseopark.github.io/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="https://hanseopark.github.io/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://hanseopark.github.io/atom.xml">

  
<link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
	<td>
	<a href= https://github.com/hanseopark> <i class="fab fa-github"></i> </a>
	<a style="padding-left:25px;" href= https://www.kaggle.com/hanseopark> <i class="fab fa-kaggle"></i> </a>
	<a style="padding-left:25px;" href= https://www.linkedin.com/in/hanseo-park-504100201> <i class="fab fa-linkedin"></i> </a>
	</td>

  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="https://hanseopark.github.io/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="https://hanseopark.github.io/about/">About</a>
        
      
    
      
    
      
    
      
    

    <!-- <a class="sidebar-nav-item" href="/archive/v.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a> -->
  </nav>
  <div class="sidebar-item">
    <p>
	  <a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fhanseopark.github.io&count_bg=%23D1D1D1&title_bg=%23555555&icon=xampp.svg&icon_color=%23E7E7E7&title=hits&edge_flat=false"/></a>
      &copy; 2025. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">


        <div class="container">

          <h3 class="masthead-title">
            <a href="/" title="Home">HAN's BLOG</a>

            <small></small>
		<div class="head-right">
			<nav id="lang-sel">
				<ul class="lang">
					
					
					
					
					<li class="masthead_menu-item lang">
						<a href="/">En </a>|<a href="/ko/" class="enabled"> Ko</a> </a>|<a href="/jp/" class="enabled"> Jp</a>
					</li>
					
				</ul>
			</nav>
		</div>


			
          </h3>

		<div>

      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://hanseopark.github.io/2021-06-27-financial-news/">
        Download financial news of yahoo with python
      </a>
    </h1>
    <span class="post-date">27 Jun 2021</span>
    <h3 id="financial-news">Financial news</h3>

<p>It is so important statemennts for study stock.</p>

<p>Iâ€™m simply check only headline and summary.</p>

<p>It is expected to study <strong>natural language processing</strong> (NLP) to future :)</p>

<h3 id="class-code">Class code</h3>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># class_Strategy.py
# import yahoo_fin import news as ynews
</span>
<span class="k">class</span> <span class="nc">NLPStrategy</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">etfname</span><span class="p">,</span> <span class="n">Offline</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">etfname</span> <span class="o">=</span> <span class="n">etfname</span>
        <span class="n">self</span><span class="p">.</span><span class="n">Offline</span> <span class="o">=</span> <span class="n">Offline</span>

    <span class="k">def</span> <span class="nf">get_news_title</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ticker</span> <span class="o">=</span> <span class="sh">'</span><span class="s">AAPL</span><span class="sh">'</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">Offline</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">url_news</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">url</span><span class="o">+</span><span class="sh">'</span><span class="s">/data_origin/FS_</span><span class="sh">'</span><span class="o">+</span><span class="n">self</span><span class="p">.</span><span class="n">etfname</span><span class="o">+</span><span class="sh">'</span><span class="s">_title.json</span><span class="sh">'</span>
            <span class="k">with</span> <span class="nf">open </span><span class="p">(</span><span class="n">url_news</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">news</span> <span class="o">=</span> <span class="n">ynews</span><span class="p">.</span><span class="nf">get_yf_rss</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">news</span><span class="p">):</span>
                <span class="n">title</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">title</span>

    <span class="k">def</span> <span class="nf">get_news_summary</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ticker</span> <span class="o">=</span> <span class="sh">'</span><span class="s">AAPL</span><span class="sh">'</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">Offline</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">url_news</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">url</span><span class="o">+</span><span class="sh">'</span><span class="s">/data_origin/FS_</span><span class="sh">'</span><span class="o">+</span><span class="n">self</span><span class="p">.</span><span class="n">etfname</span><span class="o">+</span><span class="sh">'</span><span class="s">_summary.json</span><span class="sh">'</span>
            <span class="k">with</span> <span class="nf">open </span><span class="p">(</span><span class="n">url_news</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">news</span> <span class="o">=</span> <span class="n">ynews</span><span class="p">.</span><span class="nf">get_yf_rss</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">news</span><span class="p">):</span>
                <span class="n">summary</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">summary</span>
</code></pre></div>  </div>

</blockquote>

<p>yahoo_fin API is very useful for a lot of sotckâ€™s information. If you are interesting this api please check and use <a href="http://theautomatic.net/yahoo_fin-documentation/#get_balance_sheet">page</a></p>

<p>I choose data list divided online and offline.</p>

<ul>
  <li>Online test can download only one ticker and then gather using loop in main code.</li>
  <li>Offline test can download index stock after pre-download below code for choice.</li>
</ul>

<h3 id="choice-ticker">Choice Ticker</h3>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">yahoo_fin.stock_info</span> <span class="k">as</span> <span class="n">yfs</span>
<span class="kn">from</span> <span class="n">yahoo_fin</span> <span class="kn">import</span> <span class="n">news</span> <span class="k">as</span> <span class="n">ynews</span>

<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span><span class="p">):</span>

    <span class="n">etf_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_dow</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">dow</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">etf_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_dow</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">dow</span><span class="sh">'</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">sp500</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">sp500</span><span class="sh">'</span>
        <span class="n">etf_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_sp500</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">nasdaq</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">nasdaq</span><span class="sh">'</span>
        <span class="n">etf_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_nasdaq</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">other</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">other</span><span class="sh">'</span>
        <span class="n">etf_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_other</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">selected</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">selected</span><span class="sh">'</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_ForTrading/selected_ticker.json</span><span class="sh">'</span>
        <span class="n">temp_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">temp_pd</span> <span class="o">=</span> <span class="n">temp_pd</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticker</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">etf_list</span> <span class="o">=</span> <span class="n">temp_pd</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">etf_list</span><span class="p">)</span>

    <span class="n">error_symbols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">total_news_title</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_news_summary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">etf_list</span><span class="p">):</span>
        <span class="n">list_title</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_summary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">list_news</span><span class="o">=</span> <span class="n">ynews</span><span class="p">.</span><span class="nf">get_yf_rss</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">list_news</span><span class="p">):</span>
                <span class="n">list_title</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">])</span>
                <span class="n">list_summary</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">error_symbols</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">total_news_title</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_title</span>
        <span class="n">total_news_summary</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_title</span>

    <span class="c1">#print(total_news_title)
</span>    <span class="c1">#print(total_news_summary)
</span>    <span class="nf">print</span><span class="p">(</span><span class="n">error_symbols</span><span class="p">)</span>

    <span class="n">url_title</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_origin/FS_{0}_title.json</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">url_summary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_origin/FS_{0}_summary.json</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nf">open </span><span class="p">(</span><span class="n">url_title</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">total_news_title</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">with</span> <span class="nf">open </span><span class="p">(</span><span class="n">url_summary</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">total_news_summary</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="c1">## temp reading
#    with open (url, 'r') as f:
#        temp = json.load(f)
#    print(temp)
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">s</span><span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Choice of stock</span><span class="sh">'</span><span class="s">s list (dow, sp500, nasdaq, other, selected): </span><span class="sh">"</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">News</span><span class="sh">'</span><span class="s"> title and summary of stcok in {0} at yahoo finance</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<p>This code only needs for offilne test.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Let us know how to download fincancial news.</p>

<p>I have been steuding to make model for stock using many startegy curruntly.</p>

<p>If you want to use this code, Iâ€™m very sorry that you should change code and make directory for data a little bit.</p>

<p>I should appreciate and refer for many blog on google. Thanks a lot.</p>

<p>If you satisfied this post you should check <a href="https://github.com/hanseopark/Stock/tree/master/Strategy">Github</a> and please <strong>Star</strong> :)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://hanseopark.github.io/2021-06-26-RSI/">
        Relative strength index (RSI)
      </a>
    </h1>
    <span class="post-date">26 Jun 2021</span>
    <h3 id="relative-strength-index-rsi">Relative Strength index (RSI)</h3>

<p>Itâ€™s famouse for secondary indicator of stockâ€™s market. This is presented by <strong>variance</strong> for changing upper and down.</p>

<p>It has tendency if it decrease, it is creasing and  also if it crease, it is decresing.</p>

<p>Recently it should have been not true surely. However, it has been importnat index for advance afterwards.</p>

<h3 id="class-code">Class code</h3>

<p>Anyway, this is presented how to calculate the RSI.</p>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># classRSI.py
</span> 
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">pandas_datareader</span> <span class="k">as</span> <span class="n">pdr</span>

<span class="k">class</span> <span class="nc">Stocks</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">end_day</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span>
        <span class="n">self</span><span class="p">.</span><span class="n">start_day</span> <span class="o">=</span> <span class="n">start_day</span>
        <span class="n">self</span><span class="p">.</span><span class="n">end_day</span> <span class="o">=</span> <span class="n">end_day</span>

    <span class="k">def</span> <span class="nf">calcRSI</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pdr</span><span class="p">.</span><span class="nc">DataReader</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="sh">'</span><span class="s">yahoo</span><span class="sh">'</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">start_day</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">end_day</span><span class="p">)</span>
        <span class="n">date_index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">.</span><span class="nf">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">AU</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">date_index</span><span class="p">).</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
        <span class="n">AD</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">date_index</span><span class="p">).</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">period</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
        <span class="n">RSI</span> <span class="o">=</span> <span class="n">AU</span><span class="o">/</span> <span class="p">(</span><span class="n">AD</span><span class="o">+</span><span class="n">AU</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="n">df</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">RSI</span><span class="sh">'</span><span class="p">,</span> <span class="n">RSI</span><span class="p">)</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">RSI signal</span><span class="sh">'</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">RSI</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">df</span>

</code></pre></div>  </div>
</blockquote>

<p>RSI needs variance of upper and down with average of this. And It is calculated</p>

<p><strong>RSI = Average of Upper / (Average of Upper + Average of Down) * 100</strong></p>

<p>Caculating <strong>RSI signal</strong> which is calculated moving avereage for RSI, itâ€™s comparing with two indexs.</p>

<h3 id="main-code-of-plotting">Main code of plotting</h3>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># PlotRSI.py
</span>  
 <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
 <span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
 <span class="kn">import</span> <span class="n">pandas_datareader</span> <span class="k">as</span> <span class="n">pdr</span>
 <span class="kn">import</span> <span class="n">datetime</span>
 <span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
 <span class="kn">import</span> <span class="n">matplotlib.ticker</span> <span class="k">as</span> <span class="n">ticker</span>

 <span class="kn">from</span> <span class="n">classRSI</span> <span class="kn">import</span> <span class="n">Stocks</span>

 <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
     <span class="n">td_1y</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">52</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
     <span class="n">start_day</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">td_1y</span>

     <span class="n">symbol</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">Write ticker name like aapl: </span><span class="sh">'</span><span class="p">)</span> <span class="c1">#^IXIC
</span>
     <span class="n">stock</span> <span class="o">=</span> <span class="nc">Stocks</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>

     <span class="n">df</span><span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="nf">calcRSI</span><span class="p">()</span>

     <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">)</span>

     <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

     <span class="n">ax_main</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

     <span class="k">def</span> <span class="nf">x_date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
         <span class="k">try</span><span class="p">:</span>
             <span class="k">return</span> <span class="n">index</span><span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)][:</span><span class="mi">7</span><span class="p">]</span>
         <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
             <span class="k">return</span> <span class="sh">''</span>

     <span class="c1"># For figure
</span>     <span class="n">ax_main</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">MaxNLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
     <span class="n">ax_main</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">FuncFormatter</span><span class="p">(</span><span class="n">x_date</span><span class="p">))</span>

     <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">RSI</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">RSI</span><span class="sh">'</span><span class="p">)</span>
     <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">RSI signal</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">RSI signal</span><span class="sh">'</span><span class="p">)</span>

     <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">()</span>
     <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

 <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
     <span class="nf">main</span><span class="p">()</span>

</code></pre></div>  </div>

  <p>â€‹</p>
</blockquote>

<p>It is simply calculating for start day to today and plot</p>

<h3 id="example-figure">Example figure</h3>

<p><img src="images/example_fig_RSI.png" alt="image info" /></p>

<p>Typical ticker is AAPL(Apple). This figure is presented at 2021-06-26.</p>

<p>you just know that this plot what is mean :)</p>

<h3 id="model-selection">Model, Selection</h3>

<p>For using RSI, we can make model and select ticker in index (Dow, S&amp;P500 etc) ?</p>

<p>I have simple idea to use RSI value of down to up and up to down.</p>

<ul>
  <li><strong>It is true that RSI value is under 30?</strong></li>
</ul>

<p>In my case, I have choose selected data by Bollinger bandâ€™s model. This model is explained <a href="https://hanseopark.github.io//2021-06-25-Bollinger-Band/">this post</a> which is also important finance index.</p>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># modelRSI.py
</span>  
 <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
 <span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
 <span class="kn">import</span> <span class="n">datetime</span>
 <span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

 <span class="kn">from</span> <span class="n">classRSI</span> <span class="kn">import</span> <span class="n">Stocks</span>

 <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span><span class="p">,</span> <span class="n">day_init</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">today</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()):</span>
     <span class="nf">print</span><span class="p">(</span><span class="n">stock_list</span><span class="p">)</span>

     <span class="n">selected_ticker</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">stock_list</span><span class="p">):</span>
         <span class="n">stock</span> <span class="o">=</span> <span class="nc">Stocks</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
         <span class="n">df</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="nf">calcRSI</span><span class="p">()</span>
         <span class="n">df_recent</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
         <span class="n">value_RSI</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">RSI</span><span class="sh">'</span><span class="p">])</span>
         <span class="n">value_RSI_signal</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">RSI signal</span><span class="sh">'</span><span class="p">])</span>
         <span class="n">down</span> <span class="o">=</span> <span class="mi">40</span>
         <span class="k">if</span> <span class="n">value_RSI</span> <span class="o">&lt;</span> <span class="n">down</span><span class="p">:</span>
             <span class="k">if</span> <span class="n">value_RSI</span> <span class="o">&lt;</span> <span class="n">value_RSI_signal</span><span class="p">:</span>
                 <span class="n">selected_ticker</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

     <span class="nf">print</span><span class="p">(</span><span class="n">selected_ticker</span><span class="p">)</span>

     <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_ForTrading/selected_ticker.json</span><span class="sh">'</span>
     <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">selected_ticker</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticker</span><span class="sh">'</span><span class="p">])</span>
     <span class="n">df</span><span class="p">.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
     <span class="n">td_1y</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">52</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
     <span class="n">start_day</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">td_1y</span>

     <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_ForTrading/{0}_TickerList.json</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">today</span><span class="p">.</span><span class="nf">date</span><span class="p">())</span>
     <span class="n">s_list</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="n">url</span><span class="p">)[</span><span class="sh">'</span><span class="s">Ticker</span><span class="sh">'</span><span class="p">].</span><span class="n">values</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()</span>
     <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span> <span class="o">=</span> <span class="n">s_list</span><span class="p">,</span> <span class="n">day_init</span> <span class="o">=</span> <span class="n">start_day</span><span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<p>If you change var of <strong>down</strong> like 30 to 40, you should get many ticker beyond hard condition.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Let us know what is RSI and how to caclulate with figure. And then we are going to find ticker using this model :)</p>

<p>If you want to use this code, Iâ€™m very sorry that you should change code and make directory for data a little bit.</p>

<p>I should appreciate and refer for many blog on google. Thanks a lot.</p>

<p>If you satisfied this post you should check <a href="https://github.com/hanseopark/Stock/tree/master/RelativeStrengthIndex">Github</a> and please <strong>Star</strong> :)</p>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="https://hanseopark.github.io/2021-06-25-Bollinger-Band/">
        Bollinger band with python
      </a>
    </h1>
    <span class="post-date">25 Jun 2021</span>
    <h3 id="bollinger-band-bb">Bollinger Band (BB)</h3>

<p>The bollinnger band is mening of standard deviation with calculation of moving average during 20, 60, and 120.</p>

<p>It has been known to have tendecy narrow to wide and wide to narrow again.</p>

<p>Additionally, If price of stock is over the line by BB, It has tendecy to be upper the line and If this is under the linne by BB, It has tendecu to be lower.</p>

<p>This is presented with price of stock and moving average line with Python.</p>

<p>It is needed to be downlaod on the web site. We have very useful method using <strong>pandas_datareader</strong> API.</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pandas-datareader
</code></pre></div>  </div>

</blockquote>

<h3 id="class-code">Class code</h3>

<p>Anyway, the code of class is below.</p>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># classBB.py
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">pandas_datareader</span> <span class="k">as</span> <span class="n">pdr</span>
<span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">Stocks</span><span class="p">:</span>
		 <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">end_day</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="sh">''</span><span class="p">,</span> <span class="n">Offline</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
         <span class="n">self</span><span class="p">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span>
         <span class="n">self</span><span class="p">.</span><span class="n">start_day</span> <span class="o">=</span> <span class="n">start_day</span>
         <span class="n">self</span><span class="p">.</span><span class="n">end_day</span> <span class="o">=</span> <span class="n">end_day</span>
         <span class="n">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
         <span class="n">self</span><span class="p">.</span><span class="n">Offline</span> <span class="o">=</span> <span class="n">Offline</span>

     <span class="k">def</span> <span class="nf">get_price_data</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
         <span class="nf">if </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">Offline</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
             <span class="n">url_price</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">url</span><span class="o">+</span><span class="sh">'</span><span class="s">/FS_{0}_Value.json</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">'</span><span class="s">sp500</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># If you have nasdaq stocks, you'd like to choose  nasdaq stocks rather than sp500 or dow to have many data sets
</span>             <span class="n">combined_price</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="n">url_price</span><span class="p">)</span>
             <span class="n">df</span> <span class="o">=</span> <span class="n">combined_price</span><span class="p">[</span><span class="n">combined_price</span><span class="p">.</span><span class="n">Ticker</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">symbol</span><span class="p">)]</span>
             <span class="n">df_price</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
             <span class="n">df_price</span> <span class="o">=</span> <span class="n">df_price</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">)</span>
             <span class="n">df_price</span> <span class="o">=</span> <span class="n">df_price</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">Ticker</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
             <span class="n">df_price</span> <span class="o">=</span> <span class="n">df_price</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">start_day</span> <span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">end_day</span><span class="p">]</span>

         <span class="k">else</span><span class="p">:</span>
             <span class="n">df_price</span> <span class="o">=</span> <span class="n">pdr</span><span class="p">.</span><span class="nc">DataReader</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="sh">'</span><span class="s">yahoo</span><span class="sh">'</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">start_day</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">end_day</span><span class="p">)</span>

         <span class="k">return</span> <span class="n">df_price</span>

     <span class="k">def</span> <span class="nf">with_moving_ave</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
         <span class="n">df_price</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_price_data</span><span class="p">()</span>
         <span class="n">ma5</span><span class="o">=</span> <span class="n">df_price</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
         <span class="n">ma20</span><span class="o">=</span> <span class="n">df_price</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
         <span class="n">ma60</span><span class="o">=</span> <span class="n">df_price</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
         <span class="n">ma120</span><span class="o">=</span> <span class="n">df_price</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">mean</span><span class="p">()</span>
         <span class="n">std</span> <span class="o">=</span> <span class="n">df_price</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">].</span><span class="nf">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">std</span><span class="p">()</span>
         <span class="n">bol_upper</span> <span class="o">=</span> <span class="n">ma20</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">std</span>
         <span class="n">bol_down</span> <span class="o">=</span> <span class="n">ma20</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">std</span>

         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">MA5</span><span class="sh">'</span><span class="p">,</span> <span class="n">ma5</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">MA20</span><span class="sh">'</span><span class="p">,</span> <span class="n">ma20</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">MA60</span><span class="sh">'</span><span class="p">,</span> <span class="n">ma60</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">MA120</span><span class="sh">'</span><span class="p">,</span> <span class="n">ma120</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">bol_upper</span><span class="sh">'</span><span class="p">,</span> <span class="n">bol_upper</span><span class="p">)</span>
         <span class="n">df_price</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">df_price</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span> <span class="sh">'</span><span class="s">bol_down</span><span class="sh">'</span><span class="p">,</span> <span class="n">bol_down</span><span class="p">)</span>

         <span class="k">return</span> <span class="n">df_price</span>
</code></pre></div>  </div>

</blockquote>

<p>The function get_price_data() is meaning to be download for online by yahoo finance for real time and another method to be analyzied for offline by local after download the same method. It is explaind later :)</p>

<h3 id="main-code-of-ploting">Main Code of Ploting</h3>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PlotBB.py
</span> 
<span class="kn">import</span> <span class="n">pandas_datareader</span> <span class="k">as</span> <span class="n">pdr</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">matplotlib.ticker</span> <span class="k">as</span> <span class="n">ticker</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">from</span> <span class="n">mplfinance.original_flavor</span> <span class="kn">import</span> <span class="n">candlestick2_ohlc</span>

<span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="n">classBB</span> <span class="kn">import</span> <span class="n">Stocks</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">td_1y</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">52</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#start_day = datetime.datetime(2019,1,1)
</span>    <span class="c1">#end_day = datetime.datetime(2021,5,1)
</span>    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">start_day</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">td_1y</span>

    <span class="c1"># To test just a ticker for making class
</span>    <span class="n">symbol</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">'</span><span class="s">Write ticker name like AAPL: </span><span class="sh">'</span><span class="p">)</span>
    <span class="n">url_data</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_origin/</span><span class="sh">'</span>

    <span class="n">offline_test</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">stock</span> <span class="o">=</span> <span class="nc">Stocks</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">today</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url_data</span><span class="p">,</span> <span class="n">Offline</span><span class="o">=</span> <span class="n">offline_test</span><span class="p">)</span>

    <span class="c1">## For figure
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="nf">with_moving_ave</span><span class="p">()</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="p">.</span><span class="nc">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax_main</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax_1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">x_date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index</span><span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)][:</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">''</span>
    <span class="c1"># ax_main
</span>    <span class="n">ax_main</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">MaxNLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">FuncFormatter</span><span class="p">(</span><span class="n">x_date</span><span class="p">))</span>

    <span class="n">ax_main</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="n">symbol</span><span class="o">+</span><span class="sh">'</span><span class="s"> stock</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span> <span class="p">)</span>
    <span class="c1">#ax_main.set_xlabel('Date')
</span>    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MA5</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">MA5</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MA20</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">MA20</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MA60</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">MA60</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">MA120</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">MA120</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_upper</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">bol_upper</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_down</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">bol_down</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_main</span><span class="p">.</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_down</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_upper</span><span class="sh">'</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">gray</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">candlestick2_ohlc</span><span class="p">(</span><span class="n">ax_main</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Open</span><span class="sh">'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">High</span><span class="sh">'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Low</span><span class="sh">'</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Close</span><span class="sh">'</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">colorup</span><span class="o">=</span><span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">colordown</span><span class="o">=</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">ax_main</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># ax_1
</span>    <span class="n">ax_1</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">MaxNLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax_1</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="nf">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="nc">FuncFormatter</span><span class="p">(</span><span class="n">x_date</span><span class="p">))</span>
    <span class="n">ax_1</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_1</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax_1</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
    <span class="n">ax_1</span><span class="p">.</span><span class="nf">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
     <span class="nf">main</span><span class="p">()</span>
</code></pre></div>  </div>

</blockquote>

<p>To be choice from start day to end day and if it checks offline test or not</p>

<p>For figure, using gridspec to be seperated canvas and candlestick2_ohlc that has advatage to make candlestick plot easily.</p>

<p>Any other plot library is easily explaind by google :) just search.</p>

<h3 id="example-figure">Example figure</h3>

<p><img src="../images/example_fig_BB.png" alt="image info" /></p>

<p>Typical ticker is AAPL(Apple). upper figure is presented price with BB and down figure is presented by only standard deviation at 2021-06-25.</p>

<h3 id="model-selection">Model, Selection</h3>

<p>For using Bolliner band, we can make model and select ticker in index (Dow, S&amp;P500 etc)?</p>

<p>I have simple idea to use standard deviation with recent price and prior to price.</p>

<ul>
  <li><strong>Is it true currunt standard deviation over mean of standard deviation during period?</strong></li>
  <li><strong>It is true recent price below upper line of BB?</strong></li>
  <li><strong>Is it true this ticker is rising?</strong>
    <ul>
      <li><strong>price of today over price of yesterday</strong></li>
      <li><strong>price of yesterday over price of the day befor yesterday</strong></li>
    </ul>
  </li>
</ul>

<p>If upper the condition is satisfied, I think that selected ticker has high probabily of rising to be future.</p>

<p>In my case I make the code for modeling and selection below.</p>

<p>To download index using <strong>yahoo_fin</strong> API. This is very useful to download price, financial statements and others.</p>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">yahoo</span><span class="o">-</span><span class="n">fin</span>
</code></pre></div>  </div>
</blockquote>

<blockquote>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># modelBB.py
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">yahoo_fin.stock_info</span> <span class="k">as</span> <span class="n">yfs</span>

<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="n">classBB</span> <span class="kn">import</span> <span class="n">Stocks</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span><span class="p">,</span> <span class="n">day_init</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">today</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()):</span>

   <span class="c1"># Get list of Dow tickers
</span>    <span class="n">dow_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_dow</span><span class="p">()</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sh">''</span>
    <span class="k">if</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">dow</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">dow_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_dow</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">dow</span><span class="sh">'</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">sp500</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">sp500</span><span class="sh">'</span>
        <span class="n">dow_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_sp500</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">nasdaq</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">nasdaq</span><span class="sh">'</span>
        <span class="n">dow_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_nasdaq</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">stock_list</span> <span class="o">==</span> <span class="sh">'</span><span class="s">other</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">other</span><span class="sh">'</span>
        <span class="n">dow_list</span> <span class="o">=</span> <span class="n">yfs</span><span class="p">.</span><span class="nf">tickers_other</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">dow_list</span><span class="p">)</span>

    <span class="n">selected_ticker</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">dow_list</span><span class="p">):</span>

        <span class="n">stock</span> <span class="o">=</span> <span class="nc">Stocks</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start_day</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">stock</span><span class="p">.</span><span class="nf">with_moving_ave</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span>
        <span class="n">df_day_ago_ago</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">df_day_ago</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">df_recent</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1">#print(df_day_ago)
</span>        <span class="c1">#print(df_recent)
</span>        <span class="n">value_day_ago_ago</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_day_ago_ago</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">value_day_ago</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_day_ago</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">value_recent</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">Adj Close</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">upper_recent</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_upper</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">down_recent</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">bol_down</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">std_recent</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">df_recent</span><span class="p">[</span><span class="sh">'</span><span class="s">Std</span><span class="sh">'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">std_recent</span> <span class="o">&lt;</span> <span class="n">mean</span> <span class="ow">and</span> <span class="n">value_recent</span> <span class="o">&gt;</span> <span class="n">value_day_ago</span> <span class="ow">and</span> <span class="n">value_day_ago</span> <span class="o">&gt;</span> <span class="n">value_day_ago_ago</span> <span class="ow">and</span> <span class="n">value_recent</span> <span class="o">&lt;</span>   <span class="n">upper_recent</span><span class="p">:</span>
            <span class="n">selected_ticker</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/Users/hanseopark/Work/stock/data_ForTrading/{0}_TickerList</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">today</span><span class="p">.</span><span class="nf">date</span><span class="p">())</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">selected_ticker</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Ticker</span><span class="sh">'</span><span class="p">])</span>
    <span class="c1">#df.columns = ['Ticker']
</span>    <span class="n">df</span><span class="p">.</span><span class="nf">to_json</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="sh">'</span><span class="s">csv</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">s_list</span><span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">Choice of stock</span><span class="sh">'</span><span class="s">s list (dow, sp500, nasdaq, other): </span><span class="sh">"</span><span class="p">)</span>
    <span class="n">td_1y</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">52</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#start_day = datetime.datetime(2019,1,1)
</span>    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">start_day</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">td_1y</span>

    <span class="nf">main</span><span class="p">(</span><span class="n">stock_list</span> <span class="o">=</span> <span class="n">s_list</span><span class="p">,</span><span class="n">day_init</span> <span class="o">=</span> <span class="n">start_day</span><span class="p">)</span>
</code></pre></div>  </div>

</blockquote>

<h3 id="conclusion">Conclusion</h3>

<p>Let us know what is BB (Bollinger Band) and how to calculate with figure. And then we are going to find ticekr using this model.</p>

<p>If you want to use this code, Iâ€™m very sorry that you should change code and make directory for data a little bit.</p>

<p>I should appreciate and refer for many blog on google. Thanks a lot.</p>

<p>If you satisfied this post you should check <a href="https://github.com/hanseopark/Stock/tree/master/BollingerBands">Github</a> and please <strong>Star</strong> :)</p>


  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="https://hanseopark.github.io/">Newer</a>
    
  
</div>

<!-- Pagination links -->
<div class="pagination">
	
		<a href="/" class="previous">Previous</a>
	
	<span class="page_number ">Page: 2 of 2</span>
	
		<span class="next ">Next</span>
	
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-HDN3NFF79P');
</script>

  </body>

</html>

